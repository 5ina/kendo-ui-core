#!/bin/sh

# Script should not be called directly, use rake bower:push

bowergit="git --work-tree=$2 --git-dir=$2/.git"

if [ ! -d $2 ]; then
    git clone $1 $2
else
    $bowergit fetch
    $bowergit reset --hard origin/master
    $bowergit clean -dfx
fi;

rm -rf $2/{js,styles,src}
cp -rf $3/js $2
cp -rf $3/src $2
rsync -av $3-source/src --exclude 'AspNet*' --exclude 'Kendo*' --exclude 'Telerik*' --exclude 'README' $2
cp -rf $3/styles $2

sed "s/\"version\".*/\"version\": \"$VERSION\",/" bower.json > bower.json.new && mv bower.json.new bower.json

$bowergit add --all .
$bowergit commit -m "Update to $VERSION"
$bowergit tag -a "$VERSION" -m "$VERSION"
$bowergit push origin master
$bowergit push origin "$VERSION"
