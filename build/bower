#!/bin/sh

# Script should not be called directly, use rake bower:push

bowergit="git --work-tree=$2 --git-dir=$2/.git"

if [ ! -d $2 ]; then
    git clone $1 $2
else
    $bowergit fetch
    $bowergit reset --hard origin/master
    $bowergit clean -dfx
fi;

rm -rf $2/{js,styles,src}
cp -rf $3/js $2
cp -rf $3/src $2
cp -rf $3/styles $2

mv $2/src/src $2/src/js

# OS X sed is quite peculiar - use gnu sed if present
if which gsed; then
   sed_bin="gsed"
else
   sed_bin="sed"
fi

$sed_bin -i "s/\"[[:digit:]]\+\.[[:digit:]]\+\.[[:digit:]]\+\"/\"$VERSION\"/" $2/bower.json

$bowergit add --all .
$bowergit commit -m "Update to $VERSION"
$bowergit tag -a "$TAG" -m "$VERSION"
$bowergit push origin "$TAG"
