#!upstart
description "mono FCGI"
author      "Kendo Team"


start on filesystem and started networking
stop on shutdown

respawn

script
    DEMOS="/home/{{ ansible_env.SUDO_USER }}/kendo/demos/mvc/"

    exec start-stop-daemon --start \
        --make-pidfile --pidfile /var/run/mono-fcgi.pid \
        --exec /usr/bin/fastcgi-mono-server4 \
        /applications="/demos:$DEMOS,/demos-kendo-ui:$DEMOS,/demos-php-ui:$DEMOS,/demos-jsp-ui:$DEMOS,/demos-aspnet-mvc:$DEMOS" \
        /socket="unix:/var/run/mono-fcgi.sock" 2>&1

end script

pre-start script
    echo "[`date`] (sys) Starting" >> /var/log/mono-fcgi.log
end script

post-start script
    sleep 1
    chown www-data:www-data /var/run/mono-fcgi.sock
end script

post-stop script
    rm /var/run/mono-fcgi.pid
    echo "[`date -u +%Y-%m-%dT%T.%3NZ`] (sys) Stopping" >> /var/log/mono-fcgi.log
end script

