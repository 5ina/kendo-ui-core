<?xml version='1.0' encoding='UTF-8'?>
<project>
  <actions/>
  <description>Deploy the documentation production branch to live server</description>
  <logRotator class="hudson.tasks.LogRotator">
    <daysToKeep>5</daysToKeep>
    <numToKeep>5</numToKeep>
    <artifactDaysToKeep>10</artifactDaysToKeep>
    <artifactNumToKeep>20</artifactNumToKeep>
  </logRotator>
  <keepDependencies>false</keepDependencies>
  <properties>
    <com.coravy.hudson.plugins.github.GithubProjectProperty plugin="github@1.8">
      <projectUrl>https://github.com/telerik/kendo/</projectUrl>
    </com.coravy.hudson.plugins.github.GithubProjectProperty>
  </properties>
  <scm class="hudson.plugins.git.GitSCM" plugin="git@2.0.4">
    <configVersion>2</configVersion>
    <userRemoteConfigs>
      <hudson.plugins.git.UserRemoteConfig>
        <url>git@github.com:telerik/kendo.git</url>
      </hudson.plugins.git.UserRemoteConfig>
    </userRemoteConfigs>
    <branches>
      <hudson.plugins.git.BranchSpec>
        <name>production</name>
      </hudson.plugins.git.BranchSpec>
    </branches>
    <doGenerateSubmoduleConfigurations>false</doGenerateSubmoduleConfigurations>
    <browser class="hudson.plugins.git.browser.GithubWeb"/>
    <submoduleCfg class="list"/>
    <extensions>
      <hudson.plugins.git.extensions.impl.SubmoduleOption>
        <disableSubmodules>false</disableSubmodules>
        <recursiveSubmodules>true</recursiveSubmodules>
      </hudson.plugins.git.extensions.impl.SubmoduleOption>
    </extensions>
  </scm>
  <assignedNode>master</assignedNode>
  <canRoam>false</canRoam>
  <disabled>true</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers>
    <com.cloudbees.jenkins.GitHubPushTrigger plugin="github@1.8">
      <spec></spec>
    </com.cloudbees.jenkins.GitHubPushTrigger>
  </triggers>
  <concurrentBuild>false</concurrentBuild>
  <builders>
    <hudson.tasks.Shell>
      <command>bundle --without development --path ~/gems
</command>
    </hudson.tasks.Shell>
    <hudson.tasks.Shell>
      <command>DOCS_BRANCH=production ./build/run-build-task build:production:generate_help
</command>
    </hudson.tasks.Shell>
    <hudson.tasks.Shell>
      <command>cd docs; 
bundle --without development --path ~/gems;
bundle exec bundle exec jekyll build -d /var/www/kendo-ui
rm -rf api/wrappers/*

rsync -av --delete /var/www/kendo-ui/ /mnt/Resources/AppDirector/Drops/KendoUI/KendoUI.Docs/</command>
    </hudson.tasks.Shell>
    <hudson.tasks.Shell>
      <command>#!/bin/bash

VERSION=&quot;1.0.`date +%s`&quot;;

PAYLOAD=&quot;{ \&quot;Folder\&quot;: \&quot;//telerik.com/resources/AppDirector/Drops/KendoUI\&quot;, \&quot;Version\&quot;: \&quot;$VERSION\&quot;, \&quot;Environment\&quot;: \&quot;Live\&quot;, \&quot;RepositoryName\&quot;: \&quot;Local\&quot;, \&quot;Workspace\&quot;: \&quot;Documentation\&quot;, \&quot;ClientId\&quot;: \&quot;uri:platform.cp.builds\&quot;, \&quot;ClientSecret\&quot;: \&quot;3edd5acdb61db37f3ab2bd735b058911\&quot;, \&quot;SkipRegisterPackage\&quot;: false, \&quot;OverwritePackage\&quot;: true, \&quot;SkipDateChange\&quot;: true, \&quot;SkipDeployment\&quot;: false, \&quot;DeploymentApiUrl\&quot;: \&quot;http://deploy.telerik.com/api/deployment/v1\&quot;, \&quot;RepositoryUrl\&quot;: \&quot;http://deploy.telerik.com/api/repository/v1\&quot;, \&quot;TokenEndpoint\&quot;: \&quot;https://identity.telerik.com/v2/oauth/telerik/token\&quot;, \&quot;PackageNameFormat\&quot;: \&quot;package-{0}-{1}.zip\&quot; }&quot;;

echo &quot;posting $PAYLOAD&quot;;

curl -X POST -d &quot;$PAYLOAD&quot; -H &quot;Accept: application/json&quot; -H &quot;Content-Type: application/json&quot; http://deploy.telerik.com/api/deployment/v1/packages

RESULT=&apos;&apos;

while [ &quot;$RESULT&quot; != &quot;success&quot; ]
do
    if [ &quot;$RESULT&quot; = &apos;fail&apos; ]
    then
        echo &apos;Deployment failed :(&apos;;
        exit 1;
    else
        RESULT=$(curl -s http://deploy.telerik.com/api/deployment/v1/workspaces/Documentation/stacks/KendoUI.Docs/environments/Live/status)
        echo &quot;Deployment in progress, current status: $RESULT&quot;
        sleep 2
    fi
done

echo &apos;Deployment passed :)&apos;
</command>
    </hudson.tasks.Shell>
  </builders>
  <publishers>
    <hudson.plugins.chucknorris.CordellWalkerRecorder plugin="chucknorris@0.5">
      <factGenerator/>
    </hudson.plugins.chucknorris.CordellWalkerRecorder>
  </publishers>
  <buildWrappers>
    <hudson.plugins.ansicolor.AnsiColorBuildWrapper plugin="ansicolor@0.3.1">
      <colorMapName>xterm</colorMapName>
    </hudson.plugins.ansicolor.AnsiColorBuildWrapper>
  </buildWrappers>
</project>