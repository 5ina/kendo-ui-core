<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Treelist draggable</title>

    <style> body { font-family: Tahoma } </style>

    <meta name="viewport" content="width=device-width,user-scalable=1,initial-scale=1.0" />

    <link rel="stylesheet" href="../dist/styles/web/kendo.common.css" />
    <link rel="stylesheet" href="../dist/styles/web/kendo.default.css">

    <script src="../src/jquery.js"></script>
    <script src="require.js"></script>
</head>
<body>

    <div id="treelist"></div>

    <script>
        require([
                "../src/kendo.treelist"
            ], function() {
            var dataSource = new kendo.data.TreeListDataSource({
                data: [
                  { id: 1, Name: "Daryl Sweeney", Position: "CEO", Phone: "(555) 924-9726", parentId: null },
                  { id: 2, Name: "Guy Wooten", Position: "Chief Technical Officer", Phone: "(438) 738-4935", parentId: 1 },
                  { id: 32, Name: "Buffy Weber", Position: "VP, Engineering", Phone: "(699) 838-6121", parentId: 2 },
                  { id: 3, Name: "Priscilla Frank", Position: "Chief Product Officer", Phone: "(217) 280-5300", parentId: 1 },
                  { id: 4, Name: "Ursula Holmes", Position: "EVP, Product Strategy", Phone: "(370) 983-8796", parentId: 3 },
                  { id: 24, Name: "Melvin Carrillo", Position: "Director, Developer Relations", Phone: "(344) 496-9555", parentId: 3 }
                ],

                schema: {
                    model: {
                        id: "id",
                        expanded: true
                    }
                }
            });


            var treelist = $("#treelist")
                .kendoTreeList({
                    dataSource: dataSource,
                    sortable: true,
                    height: 540,
                    columns: [
                        { field: "Position" },
                        { field: "Name" },
                        { field: "Phone" }
                    ]
                }).data("kendoTreeList");


            var dragging = new kendo.ui.HierarchicalDragAndDrop(treelist, {
                autoScroll: true,
                filter: "tbody>tr",
                itemSelector: "tr",
                allowedContainers: "#treelist",
                hintText: function(row) {
                    return row.find("td:eq(1)").text();
                },
                contains: function(source, destination) {
                    var dest = treelist.dataItem(destination);
                    var src = treelist.dataItem(source);

                    return src == dest || treelist.dataSource.contains(src, dest);
                },
                itemFromTarget: function(target) {
                    var tr = target.closest("tr");
                    return { item: tr, content: tr };
                },
                dragEnd: function(source, destination) {
                    var dest = treelist.dataItem(destination);
                    var src = treelist.dataItem(source);

                    src.set("parentId", dest ? dest.id : null);
                },
                reorderable: false,
                dropHintContainer: function(item) {
                    return item.children("td:eq(1)"); // expandable column
                },
                dropPositionFrom: function(dropHint) {
                    return dropHint.prevAll(".k-i-none").length > 0 ? "after" : "before";
                }
            });
        });
    </script>

    <style>

        .k-treelist .k-drop-hint
        {
            position: absolute;
            z-index: 10000;
            visibility: hidden;
            width: 80px;
            height: 5px;
            margin-top: -3px;
            background-color: transparent;
            background-repeat: no-repeat;
        }

    </style>
</body>
</html>
