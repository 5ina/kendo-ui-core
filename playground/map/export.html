<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="../../dist/styles/web/kendo.common.css" />
  <link rel="stylesheet" href="../../dist/styles/web/kendo.default.css" />
  <link rel="stylesheet" href="../../dist/styles/dataviz/kendo.dataviz.css" />
  <link rel="stylesheet" href="../../dist/styles/dataviz/kendo.dataviz.default.css" />
  <link rel="stylesheet" href="../../demos/mvc/content/shared/styles/examples.css" />

  <script src="../loader.js"></script>
  <script>
    requireSync([
      "../../src/jquery.js",
      "../../src/kendo.all.js",
    ]);
  </script>
  <style>
    .demo-section {
      max-width: 500px;
      max-height: 400px;
      overflow: hidden;
    }
  </style>
</head>
<body>
<div id="example">
    <div class="box">
        <h4>Export options</h4>
        <div class="box-col">
            <button class='export-pdf k-button'>Export as PDF</button>
        </div>
        <div class="box-col">
            <button class='export-img k-button'>Export as Image</button>
        </div>
        <div class="box-col">
            <button class='export-svg k-button'>Export as SVG</button>
        </div>
    </div>
    <div class="demo-section k-header" style="padding: 1em;">
        <div id="map"></div>
    </div>

    <!-- Load Pako ZLIB library to enable PDF compression -->
    <script src="pako.min.js"></script>

    <!-- Chroma.js used to colorize the map in the demo -->
    <script src="chroma.min.js"></script>

    <script>
    $(".export-pdf").click(function() {
        // Convert the DOM element to a drawing using kendo.drawing.drawDOM
        kendo.drawing.drawDOM($(".demo-section"))
        .then(function(group) {
            // Render the result as a PDF file
            return kendo.drawing.exportPDF(group, {
                paperSize: "auto",
                margin: { left: "1cm", top: "1cm", right: "1cm", bottom: "1cm" }
            });
        })
        .done(function(data) {
            // Save the PDF file
            kendo.saveAs({
                dataURI: data,
                fileName: "Map.pdf",
                proxyURL: "http://demos.telerik.com/kendo-ui/service/export"
            });
        });
    });

    $(".export-img").click(function() {
        // Convert the DOM element to a drawing using kendo.drawing.drawDOM
        kendo.drawing.drawDOM($(".demo-section"))
        .then(function(group) {
            // Render the result as a PNG image
            return kendo.drawing.exportImage(group);
        })
        .done(function(data) {
            // Save the image file
            kendo.saveAs({
                dataURI: data,
                fileName: "Map.png",
                proxyURL: "http://demos.telerik.com/kendo-ui/service/export"
            });
        });
    });

    $(".export-svg").click(function() {
        // Convert the DOM element to a drawing using kendo.drawing.drawDOM
        kendo.drawing.drawDOM($(".demo-section"))
        .then(function(group) {
            // Render the result as a SVG document
            return kendo.drawing.exportSVG(group);
        })
        .done(function(data) {
            // Save the SVG document
            kendo.saveAs({
                dataURI: data,
                fileName: "Map.svg",
                proxyURL: "http://demos.telerik.com/kendo-ui/service/export"
            });
        });
    });

    function createMap() {
        $("#map").kendoMap({
            center: [30.2681, -97.7448],
            zoom: 3,
            layers: [{
                type: "shape",
                _dataSource: {
                    type: "geojson",
                    transport: {
                        read: "countries.geo.json"
                    }
                },
                style: {
                    fill: {
                        opacity: 0.7
                    }
                }
            }, {
                type: "tile",
                urlTemplate: "http://#= subdomain #.tile.openstreetmap.org/#= zoom #/#= x #/#= y #.png",
                subdomains: ["a", "b", "c"]
            }],
            markers: [{
                location: [30.268107, -97.744821],
                shape: "pinTarget",
                tooltip: {
                    content: "Austin, TX"
                }
            }],
            shapeCreated: onShapeCreated,
            shapeMouseEnter: onShapeMouseEnter,
            shapeMouseLeave: onShapeMouseLeave
        });
    }

    var scale = chroma
        .scale(["white", "green"])
        .domain([1, 1000]);

    function onShapeCreated(e) {
        var shape = e.shape;
        var users = shape.dataItem.properties.users;
        if (users) {
            var color = scale(users).hex();
            shape.options.fill.set("color", color);
        }
    }

    function onShapeMouseEnter(e) {
        e.shape.options.set("fill.opacity", 1);
    }

    function onShapeMouseLeave(e) {
        e.shape.options.set("fill.opacity", 0.7);
    }

    $(document).ready(createMap);
    </script>
</div>
</body>
</html>
