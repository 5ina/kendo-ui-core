<!DOCTYPE html>
<html>
  <head>
    <link type="text/css" href="../../dist/styles/web/kendo.common.css" rel="stylesheet"/>
    <link type="text/css" href="../../dist/styles/web/kendo.silver.css" rel="stylesheet"/>
    <link type="text/css" href="../../dist/styles/dataviz/kendo.dataviz.css" rel="stylesheet"/>
    <link type="text/css" href="../../dist/styles/dataviz/kendo.dataviz.silver.css" rel="stylesheet"/>

    <script src="../../src/jquery.js"></script>
    <script src="../../src/kendo.core.js"></script>
    <script src="../../src/kendo.color.js"></script>

    <script src="../../src/kendo.data.js"></script>
    <script src="../../src/kendo.binder.js"></script>

    <script src="../../src/kendo.popup.js"></script>
    <script src="../../src/kendo.userevents.js"></script>
    <script src="../../src/kendo.draganddrop.js"></script>
    <script src="../../src/kendo.slider.js"></script>
    <script src="../../src/kendo.colorpicker.js"></script>
    <script src="../../src/kendo.button.js"></script>
    <script src="../../src/kendo.numerictextbox.js"></script>
    <script src="../../src/kendo.list.js"></script>
    <script src="../../src/kendo.dropdownlist.js"></script>

    <script src="../../src/util/main.js"></script>
    <script src="../../src/mixins/observers.js"></script>
    <script src="../../src/geometry/main.js"></script>
    <script src="../../src/drawing/core.js"></script>
    <script src="../../src/drawing/mixins.js"></script>
    <script src="../../src/util/text-metrics.js"></script>
    <script src="../../src/drawing/shapes.js"></script>
    <script src="../../src/drawing/animation.js"></script>
    <script src="../../src/drawing/parser.js"></script>
    <script src="../../src/drawing/svg.js"></script>
    <script src="../../src/drawing/canvas.js"></script>
    <script src="../../src/drawing/vml.js"></script>

    <script src="../../src/kendo.dataviz.core.js"></script>
    <script src="../../src/kendo.dataviz.chart.js"></script>
    <script src="../../src/kendo.dataviz.sparkline.js"></script>
    <script src="../../src/kendo.dataviz.stock.js"></script>
    <script src="../../src/kendo.dataviz.themes.js"></script>
</head>
<body>
<div style="height:200px;"></div>

<!--<div style="width: 1600px; display:inline-block; white-space:nowrap"></div>-->
<div id="chart" style="height: 700px;width: 1200px;display:inline-block;white-space:nowrap"></div>
</div>
<div id="scatterchart" style="height: 700px;"></div>
<script>
var draw = kendo.drawing;
var geom = kendo.geometry;
function getCursorPosition(e) {
    var element = e.sender.element;
    var offset = element.offset();
    var x = e.originalEvent.x.location - offset.left;
    var y = e.originalEvent.y.location - offset.top;
    return new geom.Point(x, y);
}

var data = [];
var categories = [];
for (var idx = 0; idx < 10000; idx++) {
    data.push({
        value: idx,
        date: idx
    });
    // categories.push(2000 + idx);
}
// data[0] = 1;
// data[5] = -30;
var lock = {
    x: false,
    y: false
};
 var stats = [
                    { value: 30, date: new Date("2011/12/20") },
                    { value: 50, date: new Date("2011/12/21 15:00") },
                    { value: 45, date: new Date("2011/12/22") },
                    { value: 40, date: new Date("2011/12/23") },
                    { value: 35, date: new Date("2011/12/24") },
                    { value: 40, date: new Date("2011/12/25") },
                    { value: 42, date: new Date("2011/12/26") },
                    { value: 40, date: new Date("2011/12/27") },
                    { value: 35, date: new Date("2011/12/28") },
                    { value: 43, date: new Date("2011/12/29") },
                    { value: 38, date: new Date("2011/12/30") },
                    { value: 30, date: new Date("2011/12/31") },
                    { value: 48, date: new Date("2012/01/01") },
                    { value: 49, date: new Date("2012/01/02") },
                    { value: 45, date: new Date("2012/01/03") },
                    { value: 35, date: new Date("2012/01/04") },
                    { value: 30, date: new Date("2012/01/05 10:00") }
                ];
var snap = 5;
var math = Math;
kendo.dataviz.ui.Chart.fn.updateAxes  = function(pos, cursor, e) {
    var plotArea = this._plotArea;
    var delta = -e.originalEvent[pos].delta;
    if (delta !== 0 && !lock[pos]) {
        var redraw = false;
        //this._position[pos] = cursor[pos];
        var axes = plotArea.axes;
        for (var idx = 0; idx < axes.length; idx++) {
            var axis = axes[idx];
            if (pos == "x" && !axis.options.vertical || pos == "y" && axis.options.vertical) {

                var newRange = axis.pan(delta);
                if (newRange) {
                    redraw = true;
                    // min = Math.max(newRange.min, panRange.min);
                    // max = Math.min(newRange.max, panRange.max);
                    newRange.limitRange = true;
                    plotArea.updateAxisOptions(axis, newRange);
                }
            }
        }
    }

    return redraw;
};

kendo.dataviz.ui.Chart.fn._selectionBox =  function(e) {
    var originalEvent = e.originalEvent;
    var left = math.min(originalEvent.x.startLocation, originalEvent.x.location);
    var top = math.min(originalEvent.y.startLocation, originalEvent.y.location);
    var width = Math.abs(e.originalEvent.x.initialDelta);
    var height = Math.abs(e.originalEvent.y.initialDelta);

    var pane = this._zoomPane;
    var clipBox = this._zoomPaneClipBox;                         

    if (lock.x || lock.y) {                      
        var clipbox = pane.clipBox();
        if (lock.x) {
            left =  clipbox.x1;
            width = clipbox.width();
        }
        if (lock.y) {
            top =  clipbox.y1;
            height = clipbox.height();
        }
    }

    if (originalEvent.x.location > clipBox.x2) {
        width = clipBox.x2 - originalEvent.x.startLocation;
    }

    if (originalEvent.x.location < clipBox.x1) {
        width = originalEvent.x.startLocation - clipBox.x1;
    }

    if (originalEvent.y.location > clipBox.y2) {
        height = clipBox.y2 - originalEvent.y.startLocation;
    }
    
    if (originalEvent.y.location < clipBox.y1) {
        height = originalEvent.y.startLocation - clipBox.y1;
    }

    var position = {
        left: math.max(left, clipBox.x1),
        top: math.max(top, clipBox.y1),
        width: math.min(width, clipBox.width()),
        height: math.min(height, clipBox.height())
    };
    
    return position;
};

var start = new Date().getTime();

	$("#chart").kendoChart({
        render: function(e) {
            // this._marquee = $("<div class='k-marquee'><div class='k-marquee-color'></div></div>");
        },
        dragStart: function(e) {
            //this._selectionPath.visible(true);
            // var originalEvent = e.originalEvent;
            // if (false) {//e.originalEvent.event.shiftKey) {
                // var cursor = this._toModelCoordinates(originalEvent.x.location, originalEvent.y.location);
                // this._zoomPane = this._plotArea.paneByPoint(cursor);                
                // var clipBox = this._zoomPane.clipBox().clone();
                // var chartPadding = {
                    // top: parseInt(this.element.css("paddingTop"), 10),
                    // left: parseInt(this.element.css("paddingLeft"), 10)
                // };
                // var chartOffset = this.element.offset();
                // clipBox.translate(chartPadding.left + chartOffset.left, chartPadding.top + chartOffset.top);       
                // this._zoomPaneClipBox = clipBox;
                // this._marquee
                    // .appendTo(document.body)
                    // .css({
                        // left: e.originalEvent.x.client + 1,
                        // top: e.originalEvent.y.client + 1,
                        // width: 0,
                        // height: 0
                    // });
            // }
        },

        drag: function(e) {
            if (this._zoomPane) {
                // var selectionBox = this._selectionBox(e);

                // this._marquee.css(selectionBox);

            } else {
                // var originalEvent = e.originalEvent;
                // var cursor = this._toModelCoordinates(originalEvent.x.location, originalEvent.y.location);
               // if (cursor.distanceTo(this._position) > snap) {
                    // var plotArea = this._plotArea;
                    // var redrawX = this.updateAxes("x", cursor, e);
                    // var redrawY = this.updateAxes("y", cursor, e);

                    // if (redrawX || redrawY) {
                        // plotArea.redraw(plotArea.panes);
                    // }
               // }
            }
        },

        dragEnd: function(e) {
            // var originalEvent = e.originalEvent;
            // if (this._zoomPane) {
                // this._marquee.remove();             
                // var selectionBox = this._selectionBox(e);
                // var start = this._toModelCoordinates(selectionBox.left, selectionBox.top);
                // var end = this._toModelCoordinates(selectionBox.left + selectionBox.width, selectionBox.top + selectionBox.height);
                // var plotArea = this._plotArea;
                // var axes = plotArea.axes;
                // for (var idx = 0; idx < axes.length; idx++) {
                    // var axis = axes[idx];
                    // var vertical = axis.options.vertical;
                    // if ((!lock.x && !vertical) || (!lock.y && vertical)) {
                        // var range = axis.pointsRange(start, end);                      

                        // plotArea.updateAxisOptions(axis, range);
                    // }
                // }
               // plotArea.redraw(plotArea.panes);
            // }
            // delete this._zoomPane;
        },

        zoom: function(e) {            
            // var plotArea = this._plotArea;
            // var axes = plotArea.axes;
            // var zoomed = false;
            // for (var idx = 0; idx < axes.length; idx++) {
                // var axis = axes[idx];
                // var vertical = axis.options.vertical;                
                // if ((!lock.x && !vertical) || (!lock.y && vertical)) {
                    // var range = axis.zoomRange(-e.delta);
                    // if (range) {
                        // zoomed = true;
                        // plotArea.updateAxisOptions(axis, range);
                    // }
                // }
            // }
            // if (zoomed) {
                // plotArea.redraw(plotArea.panes);
            // }
        },
        seriesDefaults: {
             type: "line"
        },
        dataSource: data,
      series: [
      {
        field: "value",
        categoryField: "date",
        // aggregate: "sum"
        // data: data
      }
      ],
        pannable: {
            lock: "y"
        },
        zoomable: {
            selection: {
                lock: "y"
            },
            mousewheel: {
                lock: "y"
            }
        },
        categoryAxis: {
                        // categories: [
                    // new Date("2012/02/01 15:00:00"), new Date("2012/02/05 01:00:00")
                // ],
                // roundToBaseUnit: false,
                // justified: true
            // justified: false,
            // name: "category",
                // categories: categories,
                min: 10.5,
                max: 15.5,
                labels: {
                    skip: 1,
                    step: 3
                },
                // justified: true
                // labels: {
                    // template: "#debugger;#"
                // }
            // baseUnit: "days",
            // roundToBaseUnit: false,
            // justified: true,
            //baseUnitStep: 2,
            // labels: {
                // format: "MM/dd HH:mm"
            // },
            // min: new Date("2011/12/31 10:00"),
            // max: new Date("2012/01/04 10:00")
           // axisCrossingValues: [1000]
        },
        tooltip: {
            visible: true
        },
        valueAxis: {    
            name: "value",
            // min: 21,
            // max: 39,
            labels: {
                format: "n2"
            }
        }

    });
    console.log(new Date().getTime() - start);
  // var stocksDataSource = new kendo.data.DataSource({
            // transport: {
                // read: {
                    // url: "../stock-data-2011.json",
                    // dataType: "json"
                // }
            // },

            // group: {
                // field: "symbol"
            // },

            // sort: {
                // field: "date",
                // dir: "asc"
            // },

            // schema: {
                // model: {
                    // fields: {
                        // date: {
                            // type: "date"
                        // }
                    // }
                // }
            // }
        // });
        
  // $("#chart").kendoChart({
                // title: {
                    // text: "Closing stock prices"
                // },
                // dataSource: stocksDataSource,
                // seriesDefaults: {
                    // type: "scatterLine",
                    // markers: {
                        // size: 6
                    // }
                // },
                // series: [{
                    // xField: "date",
                    // yField: "close"
                // }],
                // xAxis: {
                    // min: new Date("2011/05/01"),
                    // max: new Date("2011/08/01")
                // },
                // yAxis: {
                    // labels: {
                        // format: "${0:n2}",
                        // skip: 1
                    // }
                // },
                // tooltip: {
                    // visible: true,
                    // format: "{0:d}, ${1}"
                // },
                // pannable: {
                    // lock: "y"
                // },
                // zoomable: {
                    // mousewheel: {
                        // lock: "y"
                    // },
                    // selection:{
                        // lock: "y"
                    // }
                // }
            // });
</script>
</body>
</html>